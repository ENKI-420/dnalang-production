<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ΛΦ Real-Time Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #0a0a0a; color: #e0e0e0; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: #141420; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        h1 { color: #00ffcc; margin: 0; }
        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .chart-container { background: #141420; padding: 20px; border-radius: 10px; }
        .metrics { display: flex; gap: 20px; margin-top: 20px; }
        .metric-box { flex: 1; background: #1a1a2a; padding: 15px; border-radius: 5px; text-align: center; }
        .metric-value { font-size: 24px; color: #00ffcc; font-weight: bold; }
        .metric-label { color: #888; font-size: 12px; margin-top: 5px; }
        .anomaly { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { background: #1a1a2a; } 50% { background: rgba(255,0,0,0.2); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ΛΦ Quantum Coherence Monitor</h1>
        </div>
        
        <div class="metrics">
            <div class="metric-box">
                <div class="metric-value" id="current-lambda">0.000</div>
                <div class="metric-label">Λ (Lambda)</div>
            </div>
            <div class="metric-box">
                <div class="metric-value" id="current-phi">0.000</div>
                <div class="metric-label">Φ (Consciousness)</div>
            </div>
            <div class="metric-box">
                <div class="metric-value" id="current-gamma">0.000</div>
                <div class="metric-label">Γ (Decoherence)</div>
            </div>
            <div class="metric-box" id="anomaly-box">
                <div class="metric-value" id="coherence-index">0.000</div>
                <div class="metric-label">Coherence Index</div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-container">
                <canvas id="lambdaChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="phiChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="gammaChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="coherenceChart"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        // WebSocket connection
        let ws = null;
        const maxDataPoints = 50;
        
        // Data arrays
        const timeLabels = [];
        const lambdaData = [];
        const phiData = [];
        const gammaData = [];
        const coherenceData = [];
        
        // Chart configurations
        const chartConfig = {
            type: 'line',
            options: {
                responsive: true,
                animation: { duration: 0 },
                scales: {
                    y: { beginAtZero: true, grid: { color: '#2a2a3a' }, ticks: { color: '#888' } },
                    x: { grid: { color: '#2a2a3a' }, ticks: { color: '#888' } }
                },
                plugins: { legend: { labels: { color: '#e0e0e0' } } }
            }
        };
        
        // Initialize charts
        const lambdaChart = new Chart(document.getElementById('lambdaChart'), {
            ...chartConfig,
            data: {
                labels: timeLabels,
                datasets: [{ label: 'Lambda (Λ)', data: lambdaData, borderColor: '#00ffcc', tension: 0.4 }]
            }
        });
        
        const phiChart = new Chart(document.getElementById('phiChart'), {
            ...chartConfig,
            data: {
                labels: timeLabels,
                datasets: [{ label: 'Phi (Φ)', data: phiData, borderColor: '#0099ff', tension: 0.4 }]
            }
        });
        
        const gammaChart = new Chart(document.getElementById('gammaChart'), {
            ...chartConfig,
            data: {
                labels: timeLabels,
                datasets: [{ label: 'Gamma (Γ)', data: gammaData, borderColor: '#ff6666', tension: 0.4 }]
            }
        });
        
        const coherenceChart = new Chart(document.getElementById('coherenceChart'), {
            ...chartConfig,
            data: {
                labels: timeLabels,
                datasets: [{ label: 'Coherence Index', data: coherenceData, borderColor: '#ffcc00', tension: 0.4 }]
            }
        });
        
        // Connect to WebSocket
        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:8000/ws');
            
            ws.onopen = () => console.log('Connected to quantum metrics stream');
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                updateMetrics(data);
            };
            
            ws.onerror = (error) => console.error('WebSocket error:', error);
            
            ws.onclose = () => {
                console.log('Disconnected. Reconnecting...');
                setTimeout(connectWebSocket, 3000);
            };
        }
        
        // Update metrics and charts
        function updateMetrics(data) {
            // Update current values
            document.getElementById('current-lambda').textContent = (data.lambda || 0).toExponential(3);
            document.getElementById('current-phi').textContent = (data.phi || 0).toFixed(3);
            document.getElementById('current-gamma').textContent = (data.gamma || 0).toFixed(3);
            
            const coherence = data.lambda / (data.gamma + 1e-10);
            document.getElementById('coherence-index').textContent = coherence.toFixed(3);
            
            // Check for anomalies
            if (coherence < 0.1 || data.gamma > 5) {
                document.getElementById('anomaly-box').classList.add('anomaly');
            } else {
                document.getElementById('anomaly-box').classList.remove('anomaly');
            }
            
            // Update chart data
            const time = new Date().toLocaleTimeString();
            timeLabels.push(time);
            lambdaData.push(data.lambda * 1e8);
            phiData.push(data.phi);
            gammaData.push(data.gamma);
            coherenceData.push(coherence);
            
            // Limit data points
            if (timeLabels.length > maxDataPoints) {
                timeLabels.shift();
                lambdaData.shift();
                phiData.shift();
                gammaData.shift();
                coherenceData.shift();
            }
            
            // Update charts
            lambdaChart.update();
            phiChart.update();
            gammaChart.update();
            coherenceChart.update();
        }
        
        // Simulate data for demo
        function simulateData() {
            const data = {
                lambda: 2.176435e-8 * (1 + Math.random() * 0.5),
                phi: Math.min(0.987, Math.random() * 0.8 + 0.2),
                gamma: Math.random() * 2 + 0.5
            };
            updateMetrics(data);
        }
        
        // Start connection or simulation
        if (window.location.hostname === 'localhost') {
            connectWebSocket();
        } else {
            setInterval(simulateData, 1000);
        }
    </script>
</body>
</html>
